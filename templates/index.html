<!DOCTYPE html>
<html>
  <head>
    <title>Home Security System</title>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">
  </head>

  <div class = "title-box">
    <h1>Home Security System</h1>
  </div>

  <body><div class = "intro-rect">
      {% if record_status %}
      <h2>Camera Status : {{record_status}}</h2>
      {% endif %}
      {% if armed_status %}
      <h2>Alarm Status : {{armed_status}}</h2>
      {% endif %}
      <img src="{{ url_for('video_feed') }}" width="640" height="480">
      <div class = "picture-holder">
          <form method="post" action='/record'>
            {% if record_value %}
            <input type="submit" name="record" value={{record_value}}>
            {% endif %}
          </form>
          <form>
            {% if armed_value %}
            <button onclick="switch_armed()">{{armed_value}}</button>
            {% endif %}
          </form>
      </div>
    </div> 
    <div class = "intro-rect">
      <form class="select_form" method="POST" action="/selectvideo">
        <select name="videos_select"  onchange="this.form.submit();" onfocus="this.selectedIndex = -1;">
          {% for video in videos %}
          <option value= "{{video}}" SELECTED>{{video}}</option>"
          {% endfor %}
        </select>
      </form>
      <form method="post" action='/control_video'>
        {% if video_status %}
        <input type="submit" name="video_controller" value={{video_status}}>  
        {% endif %}
      </form>
      <div class = "picture-holder">
        {% if current_video %}
        <video width="640" height="480" controls>
          <source src="{{current_video}}" type="video/mp4" width="640" height="480" >
          Your browser does not support the video tag.
        </video>
        {% endif %}
      </div>
     </div>

  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script type="text/javascript">
        // start up the SocketIO connection to the server - the namespace 'test' is also included here if necessary
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        console.log('http://' + document.domain + ':' + location.port)
        
        // this is a callback that triggers when the "my response" event is emitted by the server.
        socket.on('alarm status', function(msg) {
            swal({
              title: msg.data,
              icon: "warning",
              buttons: [
                'Close window',
                'Stop alarm'
              ],
              dangerMode: true,
            }).then(function(isConfirm) {
              if (isConfirm) {
                socket.emit('alarmoff', 1);
                console.log("turn off alarm")
                swal({
                  title: 'Alarm halted',
                  icon: 'success'
                })
              } 
            });
        });
        function switch_armed() {
          $.getJSON('/arm', function(data) {
            $("#arm_button").html(data.result);
          });
        }
        
  </script>    

</html>
